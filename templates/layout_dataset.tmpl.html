{{define "layout_dataset"}}{{template "layout" .}}{{end}}

{{define "page_title"}}{{.Record.Properties.Title}} • GRO Catalog{{end}}

{{define "page_content"}}
  <!-- Breadcrumbs -->
  <div class="muted" style="margin-bottom:16px;font-size:13px">
    <a href="/" style="color:var(--link)">Catalog</a>
    <span class="sep">→</span>
    <span>{{.Record.Properties.Title}}</span>
  </div>

  <!-- Main header card -->
  <section class="card card-compact">
    <h1 style="margin:0 0 12px">{{.Record.Properties.Title}}</h1>

    <!-- Metadata chips -->
    <div class="chips" style="gap:6px;flex-wrap:wrap;margin-bottom:16px">
      <!-- Collection -->
      <span class="chip" style="background:#eff6ff;color:#1e40af;border-color:#bfdbfe">
        {{.Record.Properties.Collection}}
      </span>

      <!-- Format -->
      {{if .Record.Properties.GROMetadata.DataFormat}}
        <span class="chip" style="font-family:monospace;background:#f5f5f5;color:#404040">
          {{.Record.Properties.GROMetadata.DataFormat}}
        </span>
      {{end}}

      <!-- Status -->
      {{if eq .Record.Properties.GROMetadata.ImplementationStatus "implemented"}}
        <span class="chip" style="background:#dcfce7;color:#15803d;border-color:#bbf7d0">
          ✓ Implemented
        </span>
      {{else if eq .Record.Properties.GROMetadata.ImplementationStatus "draft"}}
        <span class="chip" style="background:#fef3c7;color:#92400e;border-color:#fde68a">
          Draft
        </span>
      {{else}}
        <span class="chip" style="background:#f3f4f6;color:#6b7280;border-color:#e5e7eb">
          Potential
        </span>
      {{end}}

      <!-- Geography -->
      {{if .Record.Properties.GROMetadata.Continent}}
        <span class="chip" style="background:#fef2f2;color:#991b1b;border-color:#fecaca">
          {{.Record.Properties.GROMetadata.Continent}}
        </span>
      {{end}}
      {{if .Record.Properties.GROMetadata.Country}}
        <span class="chip" style="background:#e0f2fe;border-color:#bae6fd;color:#075985">
          {{upper .Record.Properties.GROMetadata.Country}}
        </span>
      {{end}}
    </div>

    <!-- Description (hide if it's just metadata for database tables) -->
    {{if .Record.Properties.Abstract}}
      {{if not .DatabaseTable}}
        <p style="margin:0;color:#374151;line-height:1.6">
          {{.Record.Properties.Abstract}}
        </p>
      {{end}}
    {{end}}
  </section>

  <!-- Database Table Details -->
  {{if .DatabaseTable}}
    <section class="card card-compact">
      <h2 style="margin:0 0 16px;font-size:18px;font-weight:700">Database Table</h2>

      <!-- Metadata pills -->
      <div class="chips" style="gap:8px;flex-wrap:wrap;margin-bottom:20px">
        <!-- Table Name -->
        <span class="chip" style="background:#f9fafb;border:1px solid #e5e7eb;color:#111827;padding:6px 12px">
          <span style="color:#6b7280;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:0.5px">Table:</span>
          <span class="mono" style="font-weight:600;margin-left:6px">{{.DatabaseTable.Name}}</span>
        </span>

        <!-- Schema -->
        <span class="chip" style="background:#f0f9ff;border:1px solid #bae6fd;color:#075985;padding:6px 12px">
          <span style="opacity:0.7;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:0.5px">Schema:</span>
          <span class="mono" style="font-weight:600;margin-left:6px">{{.DatabaseTable.Schema}}</span>
        </span>

        <!-- Row Count -->
        <span class="chip" style="background:#f0fdf4;border:1px solid #bbf7d0;color:#15803d;padding:6px 12px">
          <span style="opacity:0.7;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:0.5px">Rows:</span>
          <span style="font-weight:700;margin-left:6px">{{formatNumber .DatabaseTable.RowCount}}</span>
        </span>

        <!-- Size -->
        <span class="chip" style="background:#fef3c7;border:1px solid #fde68a;color:#92400e;padding:6px 12px">
          <span style="opacity:0.8;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:0.5px">Size:</span>
          <span style="font-weight:700;margin-left:6px">{{.DatabaseTable.Size}}</span>
        </span>

        <!-- Columns count -->
        <span class="chip" style="background:#f5f3ff;border:1px solid #ddd6fe;color:#6b21a8;padding:6px 12px">
          <span style="opacity:0.8;font-size:11px;font-weight:500;text-transform:uppercase;letter-spacing:0.5px">Columns:</span>
          <span style="font-weight:700;margin-left:6px">{{len .DatabaseTable.Columns}}</span>
        </span>
      </div>

      <!-- Columns -->
      <h3 style="margin:0 0 10px;font-size:15px;font-weight:600">Columns</h3>
      <div style="overflow-x:auto">
        <table class="data-table" style="width:100%;border-collapse:collapse;font-size:13px">
          <thead>
            <tr style="background:#f9fafb;border-bottom:2px solid #e5e7eb">
              <th style="text-align:left;padding:8px;font-weight:600">#</th>
              <th style="text-align:left;padding:8px;font-weight:600">Column Name</th>
              <th style="text-align:left;padding:8px;font-weight:600">Data Type</th>
            </tr>
          </thead>
          <tbody>
            {{range $i, $col := .DatabaseTable.Columns}}
              <tr style="border-bottom:1px solid #f3f4f6">
                <td style="padding:8px;color:var(--muted)">{{add $i 1}}</td>
                <td style="padding:8px;font-family:monospace;font-weight:500">{{$col.Name}}</td>
                <td style="padding:8px;font-family:monospace;font-size:12px;color:#6b7280">{{$col.Type}}</td>
              </tr>
            {{end}}
          </tbody>
        </table>
      </div>

      <!-- Indexes -->
      {{if .DatabaseTable.Indexes}}
        <h3 style="margin:20px 0 10px;font-size:15px;font-weight:600">Indexes</h3>
        <ul style="margin:0;padding-left:20px;line-height:1.8">
          {{range .DatabaseTable.Indexes}}
            <li style="font-family:monospace;font-size:13px">{{.}}</li>
          {{end}}
        </ul>
      {{end}}
    </section>
  {{end}}

  <!-- CSV/TSV File Details -->
  {{if .CSVFile}}
    <section class="card card-compact">
      <h2 style="margin:0 0 16px;font-size:18px;font-weight:700">CSV/TSV File</h2>

      <div class="grid-2col" style="gap:16px;margin-bottom:20px">
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">Row Count</div>
          <div style="font-size:14px;font-weight:600">{{formatNumber .CSVFile.RowCount}}</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">File Size</div>
          <div style="font-size:14px;font-weight:600">{{.CSVFile.FileSizeMB}} MB</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">Columns</div>
          <div style="font-size:14px;font-weight:600">{{.CSVFile.ColumnCount}}</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">S3 Path</div>
          <div class="mono" style="font-size:11px;color:#6b7280;word-break:break-all">{{.CSVFile.S3Key}}</div>
        </div>
      </div>

      <!-- Schema -->
      <h3 style="margin:0 0 10px;font-size:15px;font-weight:600">Schema</h3>
      <div style="overflow-x:auto">
        <table class="data-table" style="width:100%;border-collapse:collapse;font-size:13px">
          <thead>
            <tr style="background:#f9fafb;border-bottom:2px solid #e5e7eb">
              <th style="text-align:left;padding:8px;font-weight:600">#</th>
              <th style="text-align:left;padding:8px;font-weight:600">Column Name</th>
              <th style="text-align:left;padding:8px;font-weight:600">Data Type</th>
              <th style="text-align:left;padding:8px;font-weight:600">Nullable</th>
            </tr>
          </thead>
          <tbody>
            {{range $i, $col := .CSVFile.Schema}}
              <tr style="border-bottom:1px solid #f3f4f6">
                <td style="padding:8px;color:var(--muted)">{{add $i 1}}</td>
                <td style="padding:8px;font-family:monospace;font-weight:500">{{$col.ColumnName}}</td>
                <td style="padding:8px;font-family:monospace;font-size:12px;color:#6b7280">{{$col.DataType}}</td>
                <td style="padding:8px">{{if $col.Nullable}}✓{{else}}-{{end}}</td>
              </tr>
            {{end}}
          </tbody>
        </table>
      </div>
    </section>
  {{end}}

  <!-- Parquet File Details -->
  {{if .ParquetFile}}
    <section class="card card-compact">
      <h2 style="margin:0 0 16px;font-size:18px;font-weight:700">Parquet File</h2>

      <div class="grid-2col" style="gap:16px;margin-bottom:20px">
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">Row Count</div>
          <div style="font-size:14px;font-weight:600">{{formatNumber .ParquetFile.RowCount}}</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">File Size</div>
          <div style="font-size:14px;font-weight:600">{{.ParquetFile.FileSizeMB}} MB</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">Columns</div>
          <div style="font-size:14px;font-weight:600">{{.ParquetFile.ColumnCount}}</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">S3 Path</div>
          <div class="mono" style="font-size:11px;color:#6b7280;word-break:break-all">{{.ParquetFile.S3Key}}</div>
        </div>
      </div>

      <!-- Schema -->
      <h3 style="margin:0 0 10px;font-size:15px;font-weight:600">Schema</h3>
      <div style="overflow-x:auto">
        <table class="data-table" style="width:100%;border-collapse:collapse;font-size:13px">
          <thead>
            <tr style="background:#f9fafb;border-bottom:2px solid #e5e7eb">
              <th style="text-align:left;padding:8px;font-weight:600">#</th>
              <th style="text-align:left;padding:8px;font-weight:600">Column Name</th>
              <th style="text-align:left;padding:8px;font-weight:600">Data Type</th>
              <th style="text-align:left;padding:8px;font-weight:600">Nullable</th>
            </tr>
          </thead>
          <tbody>
            {{range $i, $col := .ParquetFile.Schema}}
              <tr style="border-bottom:1px solid #f3f4f6">
                <td style="padding:8px;color:var(--muted)">{{add $i 1}}</td>
                <td style="padding:8px;font-family:monospace;font-weight:500">{{$col.ColumnName}}</td>
                <td style="padding:8px;font-family:monospace;font-size:12px;color:#6b7280">{{$col.DataType}}</td>
                <td style="padding:8px">{{if $col.Nullable}}✓{{else}}-{{end}}</td>
              </tr>
            {{end}}
          </tbody>
        </table>
      </div>
    </section>
  {{end}}

  <!-- Shapefile Details -->
  {{if .ShapefileFile}}
    <section class="card card-compact">
      <h2 style="margin:0 0 16px;font-size:18px;font-weight:700">Shapefile</h2>

      <div class="grid-2col" style="gap:16px;margin-bottom:20px">
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">Feature Count</div>
          <div style="font-size:14px;font-weight:600">{{formatNumber .ShapefileFile.FeatureCount}}</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">File Size</div>
          <div style="font-size:14px;font-weight:600">{{.ShapefileFile.FileSizeMB}} MB</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">Geometry Type</div>
          <div style="font-size:14px;font-weight:600">{{.ShapefileFile.GeometryType}}</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">CRS</div>
          <div class="mono" style="font-size:11px;color:#6b7280">{{.ShapefileFile.CRS}}</div>
        </div>
      </div>

      <!-- Fields -->
      <h3 style="margin:0 0 10px;font-size:15px;font-weight:600">Fields ({{len .ShapefileFile.Fields}})</h3>
      <div style="overflow-x:auto">
        <table class="data-table" style="width:100%;border-collapse:collapse;font-size:13px">
          <thead>
            <tr style="background:#f9fafb;border-bottom:2px solid #e5e7eb">
              <th style="text-align:left;padding:8px;font-weight:600">#</th>
              <th style="text-align:left;padding:8px;font-weight:600">Field Name</th>
              <th style="text-align:left;padding:8px;font-weight:600">Type</th>
              <th style="text-align:left;padding:8px;font-weight:600">Width</th>
            </tr>
          </thead>
          <tbody>
            {{range $i, $field := .ShapefileFile.Fields}}
              <tr style="border-bottom:1px solid #f3f4f6">
                <td style="padding:8px;color:var(--muted)">{{add $i 1}}</td>
                <td style="padding:8px;font-family:monospace;font-weight:500">{{$field.Name}}</td>
                <td style="padding:8px;font-family:monospace;font-size:12px;color:#6b7280">{{$field.Type}}</td>
                <td style="padding:8px">{{if $field.Width}}{{$field.Width}}{{else}}-{{end}}</td>
              </tr>
            {{end}}
          </tbody>
        </table>
      </div>
    </section>
  {{end}}

  <!-- GeoPackage Details -->
  {{if .GeoPackageFile}}
    <section class="card card-compact">
      <h2 style="margin:0 0 16px;font-size:18px;font-weight:700">GeoPackage</h2>

      <div class="grid-2col" style="gap:16px;margin-bottom:20px">
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">File Size</div>
          <div style="font-size:14px;font-weight:600">{{.GeoPackageFile.FileSizeMB}} MB</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">Layers</div>
          <div style="font-size:14px;font-weight:600">{{len .GeoPackageFile.Layers}}</div>
        </div>
        <div>
          <div class="muted" style="font-size:12px;margin-bottom:4px">S3 Path</div>
          <div class="mono" style="font-size:11px;color:#6b7280;word-break:break-all">{{.GeoPackageFile.S3Key}}</div>
        </div>
      </div>

      <!-- Layers -->
      {{range $layerIdx, $layer := .GeoPackageFile.Layers}}
        <h3 style="margin:20px 0 10px;font-size:15px;font-weight:600">
          {{if eq $layerIdx 0}}Layer{{else}}Layer {{add $layerIdx 1}}{{end}}: {{$layer.Name}}
        </h3>

        <div class="grid-2col" style="gap:16px;margin-bottom:16px">
          <div>
            <div class="muted" style="font-size:12px;margin-bottom:4px">Feature Count</div>
            <div style="font-size:14px;font-weight:600">{{formatNumber $layer.FeatureCount}}</div>
          </div>
          <div>
            <div class="muted" style="font-size:12px;margin-bottom:4px">Geometry Type</div>
            <div style="font-size:14px">{{if $layer.GeometryType}}{{$layer.GeometryType}}{{else}}-{{end}}</div>
          </div>
        </div>

        {{if $layer.CRS}}
          <div style="margin-bottom:16px">
            <div class="muted" style="font-size:12px;margin-bottom:4px">CRS</div>
            <div class="mono" style="font-size:11px;color:#6b7280;max-height:200px;overflow-y:auto">{{$layer.CRS}}</div>
          </div>
        {{end}}

        <!-- Fields -->
        <h4 style="margin:12px 0 8px;font-size:14px;font-weight:600">Fields ({{len $layer.Fields}})</h4>
        <div style="overflow-x:auto">
          <table class="data-table" style="width:100%;border-collapse:collapse;font-size:13px;margin-bottom:20px">
            <thead>
              <tr style="background:#f9fafb;border-bottom:2px solid #e5e7eb">
                <th style="text-align:left;padding:8px;font-weight:600">#</th>
                <th style="text-align:left;padding:8px;font-weight:600">Field Name</th>
                <th style="text-align:left;padding:8px;font-weight:600">Type</th>
              </tr>
            </thead>
            <tbody>
              {{range $i, $field := $layer.Fields}}
                <tr style="border-bottom:1px solid #f3f4f6">
                  <td style="padding:8px;color:var(--muted)">{{add $i 1}}</td>
                  <td style="padding:8px;font-family:monospace;font-weight:500">{{$field.Name}}</td>
                  <td style="padding:8px;font-family:monospace;font-size:12px;color:#6b7280">{{$field.Type}}</td>
                </tr>
              {{end}}
            </tbody>
          </table>
        </div>
      {{end}}
    </section>
  {{end}}

  <!-- Metadata section -->
  <section class="card card-compact">
    <h2 style="margin:0 0 12px;font-size:18px;font-weight:700">Record Metadata</h2>

    <!-- GRO Metadata -->
    {{if .Record.Properties.GROMetadata}}
      <div style="margin-bottom:20px">
        <h3 style="margin:0 0 8px;font-size:14px;font-weight:600;color:#6b7280">GRO Catalog</h3>
        <div style="background:#f9fafb;border:1px solid #e5e7eb;border-radius:6px;padding:12px">
          <table style="width:100%;font-size:13px;border-spacing:0">
            {{if .Record.Properties.GROMetadata.Owner}}
            <tr>
              <td style="padding:4px 12px 4px 0;color:#6b7280;vertical-align:top;width:180px">Owner</td>
              <td style="padding:4px 0;font-family:monospace;color:#111827">{{.Record.Properties.GROMetadata.Owner}}</td>
            </tr>
            {{end}}
            {{if .Record.Properties.GROMetadata.UpdateFrequency}}
            <tr>
              <td style="padding:4px 12px 4px 0;color:#6b7280;vertical-align:top">Update Frequency</td>
              <td style="padding:4px 0;color:#111827">{{.Record.Properties.GROMetadata.UpdateFrequency}}</td>
            </tr>
            {{end}}
            {{if .Record.Properties.GROMetadata.V6JobFile}}
            <tr>
              <td style="padding:4px 12px 4px 0;color:#6b7280;vertical-align:top">v6 Job File</td>
              <td style="padding:4px 0;font-family:monospace;font-size:12px;color:#059669">{{.Record.Properties.GROMetadata.V6JobFile}}</td>
            </tr>
            {{end}}
            {{if .Record.Properties.GROMetadata.S3Path}}
            <tr>
              <td style="padding:4px 12px 4px 0;color:#6b7280;vertical-align:top">Source URL</td>
              <td style="padding:4px 0"><a href="{{.Record.Properties.GROMetadata.S3Path}}" target="_blank" style="color:var(--link);font-size:13px;word-break:break-all">{{.Record.Properties.GROMetadata.S3Path}}</a></td>
            </tr>
            {{end}}
          </table>
        </div>
      </div>
    {{end}}

    <!-- GeoCatalogo Metadata -->
    {{if .Record.Properties.GeoCatalogo}}
      <div>
        <h3 style="margin:0 0 8px;font-size:14px;font-weight:600;color:#6b7280">System Info</h3>
        <div style="background:#f0f9ff;border:1px solid #bae6fd;border-radius:6px;padding:12px">
          <table style="width:100%;font-size:13px;border-spacing:0">
            <tr>
              <td style="padding:4px 12px 4px 0;color:#075985;vertical-align:top;width:180px">Catalog ID</td>
              <td style="padding:4px 0;font-family:monospace;color:#0c4a6e">{{.Record.ID}}</td>
            </tr>
            <tr>
              <td style="padding:4px 12px 4px 0;color:#075985;vertical-align:top">Schema</td>
              <td style="padding:4px 0;color:#0c4a6e">{{.Record.Properties.GeoCatalogo.Schema}}</td>
            </tr>
            <tr>
              <td style="padding:4px 12px 4px 0;color:#075985;vertical-align:top">Inserted</td>
              <td style="padding:4px 0;color:#0c4a6e">{{.Record.Properties.GeoCatalogo.Inserted}}</td>
            </tr>
          </table>
        </div>
      </div>
    {{end}}
  </section>

  <!-- Raw JSON section (collapsible) -->
  <section class="card card-compact">
    <details>
      <summary style="cursor:pointer;font-size:18px;font-weight:700;padding:4px 0;user-select:none">
        📋 Raw JSON Record
      </summary>
      <div style="margin-top:12px">
        <pre style="background:#1f2937;color:#e5e7eb;padding:16px;border-radius:6px;overflow-x:auto;font-size:12px;line-height:1.5;margin:0"><code>{{.RecordJSON}}</code></pre>
      </div>
    </details>
  </section>
{{end}}
