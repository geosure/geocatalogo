{{define "layout_api_docs"}}{{template "layout" .}}{{end}}

{{define "page_title"}}API Documentation ‚Ä¢ GRO Catalog{{end}}

{{define "page_content"}}
  <div class="muted" style="margin-bottom:16px;font-size:13px">
    <a href="/" style="color:var(--link)">Catalog</a>
    <span class="sep">‚Üí</span>
    <span>API Docs</span>
  </div>

  <h1>üîå GRO API Documentation</h1>
  <p class="muted" style="margin-bottom:24px">
    Complete guide to the GRO RESTful API (v1.0) - Nested, grouped 5D navigation for agents and humans
  </p>

  <!-- API Version Notice -->
  <section class="card" style="background:#eff6ff;border:1px solid #93c5fd">
    <div style="display:flex;align-items:start;gap:16px">
      <div style="font-size:40px">‚ÑπÔ∏è</div>
      <div style="flex:1">
        <h3 style="margin:0 0 8px;color:#1e40af;font-size:18px">Two API Endpoints Available</h3>
        <p style="margin:0 0 12px;color:#1e40af;font-size:14px;line-height:1.6">
          <strong>üÜï GRO RESTful API (port 9000):</strong> New nested, grouped structure with explicit 5D navigation. <em>This is the recommended API for all new integrations.</em><br>
          <strong>Legacy STAC API (port 8000):</strong> Original flat query interface with property filters. Still supported but will eventually be deprecated.
        </p>
        <div style="background:white;border-radius:6px;padding:12px;font-family:monospace;font-size:13px;margin-top:12px">
          <div style="color:#1e40af;margin-bottom:4px"># GRO RESTful API (recommended)</div>
          <div style="margin-bottom:12px">http://localhost:9000</div>

          <div style="color:#64748b;margin-bottom:4px"># Legacy STAC API (supported)</div>
          <div>http://localhost:8000</div>
        </div>
      </div>
    </div>
  </section>

  <!-- GRO RESTful API Structure -->
  <section class="card">
    <h2 style="margin:0 0 24px">üöÄ GRO RESTful API (v1.0) - Port 9000</h2>
    <p class="muted" style="margin:0 0 24px">
      The GRO API provides nested, grouped endpoints organized by 5 dimensions. All endpoints are under <code style="background:#e2e8f0;padding:2px 6px;border-radius:3px">/api/v1/</code> and return JSON.
    </p>

    <!-- Quick Start -->
    <div style="background:#f0fdf4;border:1px solid #86efac;border-radius:8px;padding:20px;margin-bottom:24px">
      <h3 style="margin:0 0 12px;color:#15803d">Quick Start</h3>
      <div style="background:white;border-radius:6px;padding:16px;font-family:monospace;font-size:13px">
        <div style="color:#64748b;margin-bottom:4px"># Get API overview</div>
        <div style="margin-bottom:16px">curl http://localhost:9000/</div>

        <div style="color:#64748b;margin-bottom:4px"># List all collections</div>
        <div style="margin-bottom:16px">curl http://localhost:9000/api/v1/collections</div>

        <div style="color:#64748b;margin-bottom:4px"># Get all AI agents</div>
        <div style="margin-bottom:16px">curl http://localhost:9000/api/v1/collections/ai_agent</div>

        <div style="color:#64748b;margin-bottom:4px"># List all continents</div>
        <div>curl http://localhost:9000/api/v1/geography/continents</div>
      </div>
    </div>

    <!-- 5 Dimensions -->
    <h3 style="margin:0 0 16px;color:#334155">Five Dimensions of Navigation</h3>

    <!-- 1. Collections -->
    <div style="margin-bottom:32px">
      <h4 style="margin:0 0 12px;color:#7c2d12;font-size:16px">üìö 1. Collections</h4>
      <p style="margin:0 0 12px;color:#64748b;font-size:14px">Browse by resource type (21 collections)</p>
      <table style="width:100%;border-collapse:collapse;font-size:14px;margin-bottom:12px">
        <tr style="background:#f8fafc;border-bottom:2px solid #e2e8f0">
          <th style="text-align:left;padding:12px;font-weight:600">Endpoint</th>
          <th style="text-align:left;padding:12px;font-weight:600">Description</th>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/collections</td>
          <td style="padding:12px">List all 21 collections with counts</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/collections/{name}</td>
          <td style="padding:12px">Get all resources in a collection</td>
        </tr>
      </table>
      <div style="background:#f8fafc;border-radius:6px;padding:12px;font-family:monospace;font-size:12px">
        <div style="color:#64748b">Examples:</div>
        <div>curl http://localhost:9000/api/v1/collections/ai_agent</div>
        <div>curl http://localhost:9000/api/v1/collections/existing_db</div>
      </div>
    </div>

    <!-- 2. Formats -->
    <div style="margin-bottom:32px">
      <h4 style="margin:0 0 12px;color:#7c2d12;font-size:16px">üì¶ 2. Data Formats</h4>
      <p style="margin:0 0 12px;color:#64748b;font-size:14px">Browse by data format (56 formats)</p>
      <table style="width:100%;border-collapse:collapse;font-size:14px;margin-bottom:12px">
        <tr style="background:#f8fafc;border-bottom:2px solid #e2e8f0">
          <th style="text-align:left;padding:12px;font-weight:600">Endpoint</th>
          <th style="text-align:left;padding:12px;font-weight:600">Description</th>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/formats</td>
          <td style="padding:12px">List all 56 formats with counts</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/formats/{name}</td>
          <td style="padding:12px">Get all resources with this format</td>
        </tr>
      </table>
      <div style="background:#f8fafc;border-radius:6px;padding:12px;font-family:monospace;font-size:12px">
        <div style="color:#64748b">Examples:</div>
        <div>curl http://localhost:9000/api/v1/formats/csv</div>
        <div>curl http://localhost:9000/api/v1/formats/lambda</div>
      </div>
    </div>

    <!-- 3. Implementation Status -->
    <div style="margin-bottom:32px">
      <h4 style="margin:0 0 12px;color:#7c2d12;font-size:16px">üö¶ 3. Implementation Status</h4>
      <p style="margin:0 0 12px;color:#64748b;font-size:14px">Browse by deployment state (12 statuses)</p>
      <table style="width:100%;border-collapse:collapse;font-size:14px;margin-bottom:12px">
        <tr style="background:#f8fafc;border-bottom:2px solid #e2e8f0">
          <th style="text-align:left;padding:12px;font-weight:600">Endpoint</th>
          <th style="text-align:left;padding:12px;font-weight:600">Description</th>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/statuses</td>
          <td style="padding:12px">List all 12 statuses with counts</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/statuses/{name}</td>
          <td style="padding:12px">Get all resources with this status</td>
        </tr>
      </table>
      <div style="background:#f8fafc;border-radius:6px;padding:12px;font-family:monospace;font-size:12px">
        <div style="color:#64748b">Examples:</div>
        <div>curl http://localhost:9000/api/v1/statuses/implemented</div>
        <div>curl http://localhost:9000/api/v1/statuses/active</div>
      </div>
    </div>

    <!-- 4. Ownership -->
    <div style="margin-bottom:32px">
      <h4 style="margin:0 0 12px;color:#7c2d12;font-size:16px">üë• 4. Ownership</h4>
      <p style="margin:0 0 12px;color:#64748b;font-size:14px">Browse by owner (32 owners)</p>
      <table style="width:100%;border-collapse:collapse;font-size:14px;margin-bottom:12px">
        <tr style="background:#f8fafc;border-bottom:2px solid #e2e8f0">
          <th style="text-align:left;padding:12px;font-weight:600">Endpoint</th>
          <th style="text-align:left;padding:12px;font-weight:600">Description</th>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/owners</td>
          <td style="padding:12px">List all 32 owners with counts</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/owners/{name}</td>
          <td style="padding:12px">Get all resources owned by this team/person</td>
        </tr>
      </table>
      <div style="background:#f8fafc;border-radius:6px;padding:12px;font-family:monospace;font-size:12px">
        <div style="color:#64748b">Examples:</div>
        <div>curl http://localhost:9000/api/v1/owners/@data-platform</div>
        <div>curl http://localhost:9000/api/v1/owners/@clankr</div>
      </div>
    </div>

    <!-- 5. Geography (Nested Hierarchy) -->
    <div style="margin-bottom:32px">
      <h4 style="margin:0 0 12px;color:#7c2d12;font-size:16px">üåç 5. Geography (4-Level Hierarchy)</h4>
      <p style="margin:0 0 12px;color:#64748b;font-size:14px">Explicit nested navigation with list endpoints at each level</p>

      <div style="background:#f0fdf4;border:1px solid #86efac;border-radius:6px;padding:16px;margin-bottom:16px">
        <div style="font-weight:600;margin-bottom:8px;color:#15803d">‚ú® Key Pattern: Lists vs. Resources</div>
        <div style="font-size:13px;color:#15803d;line-height:1.6">
          <strong>PLURAL</strong> endpoints (continents, countries, states, cities) return <strong>LISTS with counts</strong><br>
          <strong>SINGULAR</strong> endpoints (continent name, country name) return <strong>FILTERED RESOURCES</strong>
        </div>
      </div>

      <table style="width:100%;border-collapse:collapse;font-size:13px;margin-bottom:12px">
        <tr style="background:#f8fafc;border-bottom:2px solid #e2e8f0">
          <th style="text-align:left;padding:10px;font-weight:600">Level</th>
          <th style="text-align:left;padding:10px;font-weight:600">Endpoint</th>
          <th style="text-align:left;padding:10px;font-weight:600">Returns</th>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">0</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET /api/v1/geography/continents</td>
          <td style="padding:10px">List all 7 continents</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">0</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET /api/v1/geography/countries</td>
          <td style="padding:10px">List all 54 countries</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">1</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET /api/v1/geography/continents/{continent}</td>
          <td style="padding:10px">Resources in continent</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">1</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET /api/v1/geography/continents/{continent}/countries</td>
          <td style="padding:10px">List countries in continent</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">2</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET .../countries/{country}</td>
          <td style="padding:10px">Resources in country</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">2</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET .../countries/{country}/states</td>
          <td style="padding:10px">List states in country</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">3</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET .../states/{state}</td>
          <td style="padding:10px">Resources in state</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">3</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET .../states/{state}/cities</td>
          <td style="padding:10px">List cities in state</td>
        </tr>
        <tr style="border-bottom:1px solid #e5e7eb">
          <td style="padding:10px;font-weight:600">4</td>
          <td style="padding:10px;font-family:monospace;color:#0b63ce">GET .../cities/{city}</td>
          <td style="padding:10px">Resources in city</td>
        </tr>
      </table>

      <div style="background:#f8fafc;border-radius:6px;padding:12px;font-family:monospace;font-size:12px">
        <div style="color:#64748b">Examples:</div>
        <div>curl http://localhost:9000/api/v1/geography/continents/north-america</div>
        <div>curl http://localhost:9000/api/v1/geography/continents/north-america/countries</div>
        <div>curl http://localhost:9000/api/v1/geography/continents/north-america/countries/us</div>
        <div>curl http://localhost:9000/api/v1/geography/continents/north-america/countries/us/states/california/cities/los_angeles</div>
      </div>
    </div>

    <!-- Additional Endpoints -->
    <h3 style="margin:0 0 16px;color:#334155">Additional Endpoints</h3>

    <table style="width:100%;border-collapse:collapse;font-size:14px;margin-bottom:12px">
      <tr style="background:#f8fafc;border-bottom:2px solid #e2e8f0">
        <th style="text-align:left;padding:12px;font-weight:600">Endpoint</th>
        <th style="text-align:left;padding:12px;font-weight:600">Description</th>
      </tr>
      <tr style="border-bottom:1px solid #e5e7eb">
        <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/search?q={query}</td>
        <td style="padding:12px">Text search with filters and pagination</td>
      </tr>
      <tr style="border-bottom:1px solid #e5e7eb">
        <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/records/{id}</td>
        <td style="padding:12px">Get specific record by ID</td>
      </tr>
      <tr style="border-bottom:1px solid #e5e7eb">
        <td style="padding:12px;font-family:monospace;color:#0b63ce">GET /api/v1/resources?...</td>
        <td style="padding:12px">Unified query with multi-filter support (17 filters available)</td>
      </tr>
    </table>

    <div style="background:#f8fafc;border-radius:6px;padding:12px;font-family:monospace;font-size:12px;margin-bottom:24px">
      <div style="color:#64748b"># Unified resource query</div>
      <div>curl 'http://localhost:9000/api/v1/resources?collection=ai_agent&format=csv&status=implemented'</div>
    </div>

    <!-- Response Format -->
    <h3 style="margin:0 0 16px;color:#334155">Response Format</h3>
    <p style="margin:0 0 12px;color:#64748b;font-size:14px">All responses are JSON. Lists include counts, resource endpoints include matched count and records array.</p>

    <div style="background:#1e293b;color:#e2e8f0;border-radius:6px;padding:16px;font-family:monospace;font-size:12px;overflow-x:auto">
<pre style="margin:0">{
  "matched": 7,
  "returned": 7,
  "records": [
    {
      "id": "clankr_catalog_agent",
      "type": "Feature",
      "properties": {
        "title": "Catalog Management Agent",
        "collection": "ai_agent",
        "gro_metadata": {
          "continent": "clankr",
          "implementation_status": "active",
          "data_format": "lambda_service",
          "owner": "@clankr"
        }
      }
    }
  ]
}</pre>
    </div>
  </section>

  <!-- Link to Query Builder -->
  <section class="card" style="background:#f8fafc;border:1px solid #cbd5e1">
    <div style="display:flex;align-items:center;gap:16px">
      <div style="font-size:48px">üéØ</div>
      <div style="flex:1">
        <h3 style="margin:0 0 8px;color:#334155;font-size:18px">Try the Interactive Query Builder (Legacy STAC API)</h3>
        <p style="margin:0 0 12px;color:#64748b;font-size:14px">
          Build and test queries visually with live results. Note: Currently uses the legacy STAC API on port 8000. GRO API query builder coming soon.
        </p>
        <a href="/query" style="display:inline-block;background:#475569;color:white;padding:10px 20px;border-radius:6px;text-decoration:none;font-weight:600;font-size:14px">
          Open Query Builder ‚Üí
        </a>
      </div>
    </div>
  </section>

  <!-- Property Filters Reference -->
  <section class="card">
    <h2 style="margin:0 0 24px">üéØ Legacy STAC API - Property Filters Reference (Port 8000)</h2>
    <p class="muted" style="margin:0 0 24px">
      The legacy STAC API on port 8000 supports property filters for precise querying. <strong>All filters query gro_metadata fields.</strong> Combine multiple filters for powerful queries. Note: This API will eventually be deprecated in favor of the GRO RESTful API above.
    </p>

    <div style="display:grid;gap:24px">
      <!-- Geographic Filters -->
      <div>
        <h3 style="margin:0 0 16px;color:#0f766e;font-size:18px;border-bottom:2px solid #99f6e4;padding-bottom:8px">
          üåç Geographic Filters (gro_metadata.continent, etc.)
        </h3>
        <table style="width:100%;border-collapse:collapse;font-size:14px">
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce;width:200px">continent</td>
            <td style="padding:12px 0">
              Filter by region (exact match)<br>
              <span style="font-size:12px;color:#64748b">
                Values: africa, asia, clankr, europe, global, infra, north-america, oceania, south-america, team, verbs (11 total)
              </span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?continent=clankr</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">country</td>
            <td style="padding:12px 0">
              Filter by country (exact match)<br>
              <span style="font-size:12px;color:#64748b">Example: colombia, united_states, etc.</span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?country=colombia</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">state_province</td>
            <td style="padding:12px 0">Filter by state/province (exact match)</td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?state_province=california</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">city</td>
            <td style="padding:12px 0">Filter by city (exact match)</td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?city=los_angeles</td>
          </tr>
          <tr>
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">geographic_scope</td>
            <td style="padding:12px 0">
              Filter by scope (exact match)<br>
              <span style="font-size:12px;color:#64748b">Values: global, regional, national, local</span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?geographic_scope=global</td>
          </tr>
        </table>
      </div>

      <!-- Metadata Filters -->
      <div>
        <h3 style="margin:0 0 16px;color:#7c2d12;font-size:18px;border-bottom:2px solid #fed7aa;padding-bottom:8px">
          üìã Metadata Filters (gro_metadata.*)
        </h3>
        <table style="width:100%;border-collapse:collapse;font-size:14px">
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce;width:200px">collection</td>
            <td style="padding:12px 0">
              Filter by collection type (exact match)<br>
              <details style="margin-top:4px">
                <summary style="font-size:12px;color:#64748b;cursor:pointer">21 collections (click to expand)</summary>
                <div style="font-size:11px;color:#64748b;margin-top:4px;line-height:1.6">
                  ai_agent, api_service, automation_bot, catalog_management_bot, claude_projects, data_inspection_bot, existing_db, existing_local, external_academic, external_api, external_download, external_government, external_news, external_other, historical_agent, infrastructure, internal_tool, operational_service, potential_v6, team_member, verb_app
                </div>
              </details>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?collection=ai_agent</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">type</td>
            <td style="padding:12px 0">
              Filter by resource type (exact match)<br>
              <span style="font-size:12px;color:#64748b">Value: dataset (all 1,803 records)</span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?type=dataset</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">owner</td>
            <td style="padding:12px 0">
              Filter by owner (exact match)<br>
              <details style="margin-top:4px">
                <summary style="font-size:12px;color:#64748b;cursor:pointer">32 owners (click to expand)</summary>
                <div style="font-size:11px;color:#64748b;margin-top:4px;line-height:1.6">
                  Top: @data-platform (1199), @team-data-eng (227), @clankr (90), @geosure-data-team (53), @team-handle (45), @GeoSure (33), @team-safety-insights (24), @geosure/data-team (23), @team-geosure (17), @infrastructure (16), @geosure (13), @gro-platform (12), @way-barrios (11), and 19 others
                </div>
              </details>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?owner=@clankr</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">data_format</td>
            <td style="padding:12px 0">
              Filter by data format (exact match)<br>
              <details style="margin-top:4px">
                <summary style="font-size:12px;color:#64748b;cursor:pointer">56 formats (click to expand)</summary>
                <div style="font-size:11px;color:#64748b;margin-top:4px;line-height:1.6">
                  Top: api (319), csv (218), db (173), duckdb (145), parquet (96), news (78), ecs (70), lambda (67), government (62), db_sql (55), python_script (50), shell (35), pdf (32), xlsx (30), other (30), and 41 more
                </div>
              </details>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?data_format=api</td>
          </tr>
          <tr>
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">implementation_status</td>
            <td style="padding:12px 0">
              Filter by implementation status (exact match)<br>
              <span style="font-size:12px;color:#64748b">
                Values: draft (617), implemented (526), potential (541), active (88), deployed (10), archived (11), and 6 others (advisor, conditional, foundation, maintenance, planned, research)
              </span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?implementation_status=active</td>
          </tr>
        </table>
      </div>

      <!-- System Filters -->
      <div>
        <h3 style="margin:0 0 16px;color:#1e40af;font-size:18px;border-bottom:2px solid #bfdbfe;padding-bottom:8px">
          ‚öôÔ∏è System Filters (gro_metadata.*)
        </h3>
        <table style="width:100%;border-collapse:collapse;font-size:14px">
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce;width:200px">database_table</td>
            <td style="padding:12px 0">
              Filter by database table (exact match)<br>
              <details style="margin-top:4px">
                <summary style="font-size:12px;color:#64748b;cursor:pointer">47 tables (click to expand)</summary>
                <div style="font-size:11px;color:#64748b;margin-top:4px;line-height:1.6;font-family:monospace">
                  raw_articles, filtered_news, geosure_news, geosure_news_geocoded, city_recent_articles, safety_articles, gdelt_safety_articles, article_geocoding_process, article_location_associations, gdelt_events, acled_events, gdelt_processing_status, georeference_status, processing_status, location_processing_status, adm_0, adm_1, adm_2, admin_bboxes, divisions_area, divisions_point, geonames_cities, world_urban_areas, h3_l8_union_cities_urban, and 23 more
                </div>
              </details>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?database_table=raw_articles</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">v6_job_file</td>
            <td style="padding:12px 0">Filter by v6 job file path (partial match)</td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?v6_job_file=bootstrap</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">v6_job_type</td>
            <td style="padding:12px 0">
              Filter by v6 job type (exact match)<br>
              <span style="font-size:12px;color:#64748b">
                Values: bootstrap (441), collectors (158), run (18)
              </span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?v6_job_type=collectors</td>
          </tr>
          <tr style="border-bottom:1px solid #e5e7eb">
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">update_frequency</td>
            <td style="padding:12px 0">
              Filter by update frequency<br>
              <span style="font-size:12px;color:#64748b">Example: daily, hourly, weekly, etc.</span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?update_frequency=daily</td>
          </tr>
          <tr>
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce">file_size_mb</td>
            <td style="padding:12px 0">
              Filter by file size (for data files)<br>
              <span style="font-size:12px;color:#64748b">Stored in gro_metadata.file_size_mb</span>
            </td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">N/A</td>
          </tr>
        </table>
      </div>

      <!-- General Filters -->
      <div>
        <h3 style="margin:0 0 16px;color:#4a5568;font-size:18px;border-bottom:2px solid #e2e8f0;padding-bottom:8px">
          üîç General Filters
        </h3>
        <table style="width:100%;border-collapse:collapse;font-size:14px">
          <tr>
            <td style="padding:12px 12px 12px 0;font-family:monospace;color:#0b63ce;width:200px">title</td>
            <td style="padding:12px 0">Filter by title (partial match)</td>
            <td style="padding:12px 0;font-family:monospace;color:#64748b;font-size:12px">?title=news</td>
          </tr>
        </table>
      </div>
    </div>

    <!-- Combination Examples -->
    <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin-top:24px">
      <h3 style="margin:0 0 16px;color:#334155">üí™ Combining Multiple Filters</h3>
      <p style="margin:0 0 16px;color:#475569">
        Combine multiple property filters using AND logic (all must match). Mix property filters with text search for powerful queries.
      </p>

      <div style="background:white;border-radius:6px;padding:16px;font-family:monospace;font-size:13px">
        <div style="color:#64748b;margin-bottom:4px"># All active AI agents in clankr ecosystem</div>
        <div style="margin-bottom:16px">curl 'http://localhost:8000/?continent=clankr&collection=ai_agent&implementation_status=active'</div>

        <div style="color:#64748b;margin-bottom:4px"># All database tables containing "article"</div>
        <div style="margin-bottom:16px">curl 'http://localhost:8000/?collection=existing_db&database_table=raw_articles'</div>

        <div style="color:#64748b;margin-bottom:4px"># All v6 collector jobs</div>
        <div style="margin-bottom:16px">curl 'http://localhost:8000/?collection=potential_v6&v6_job_type=collectors&maxrecords=50'</div>

        <div style="color:#64748b;margin-bottom:4px"># All Python scripts owned by @clankr</div>
        <div style="margin-bottom:16px">curl 'http://localhost:8000/?data_format=python_script&owner=@clankr'</div>

        <div style="color:#64748b;margin-bottom:4px"># All API data formats managed by data-platform</div>
        <div style="margin-bottom:16px">curl 'http://localhost:8000/?data_format=api&owner=@data-platform&maxrecords=100'</div>

        <div style="color:#64748b;margin-bottom:4px"># All implemented resources in North America</div>
        <div>curl 'http://localhost:8000/?continent=north-america&implementation_status=implemented'</div>
      </div>
    </div>

    <!-- Complete gro_metadata Schema -->
    <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin-top:24px">
      <h3 style="margin:0 0 16px;color:#334155">üìñ Complete gro_metadata Schema</h3>
      <p style="margin:0 0 16px;color:#475569">
        All catalog entries have these fields available in <code style="background:#e2e8f0;padding:2px 6px;border-radius:3px">properties.gro_metadata</code>:
      </p>

      <div style="background:white;border:1px solid #e2e8f0;border-radius:6px;padding:16px;font-family:monospace;font-size:12px;line-height:2">
        <div><strong>continent</strong> - Geographic region (11 values)</div>
        <div><strong>country</strong> - Country code or name</div>
        <div><strong>state_province</strong> - State/province</div>
        <div><strong>city</strong> - City name</div>
        <div><strong>geographic_scope</strong> - global, regional, national, local</div>
        <div><strong>owner</strong> - Team/platform (32 unique owners)</div>
        <div><strong>data_format</strong> - Format type (56 unique formats)</div>
        <div><strong>implementation_status</strong> - Status (12 states)</div>
        <div><strong>database_table</strong> - Table name (47 tables)</div>
        <div><strong>v6_job_type</strong> - Job type (3 types)</div>
        <div><strong>update_frequency</strong> - Update schedule</div>
        <div><strong>file_size_mb</strong> - File size in MB</div>
      </div>

      <p style="margin:16px 0 0;color:#475569;font-size:13px">
        ‚úÖ <strong>Agents:</strong> Query these fields programmatically to discover capabilities, find data, and coordinate autonomously.<br>
        ‚úÖ <strong>Humans:</strong> Use the interactive query builder above or curl commands to explore the catalog.
      </p>
    </div>
  </section>

  <!-- Traditional Endpoints -->
  <section class="card">
    <h2 style="margin:0 0 24px">üìã Legacy STAC API - Traditional Query Methods (Port 8000)</h2>

    <div style="margin-bottom:32px">
      <h3 style="margin:0 0 12px;color:#334155;font-size:18px">GET /?recordids={id}</h3>
      <p style="color:#64748b;margin:0 0 16px">Retrieve specific catalog records by ID</p>

      <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;padding:16px">
        <strong>Parameters:</strong>
        <table style="width:100%;margin-top:12px;font-size:14px">
          <tr style="border-bottom:1px solid #e2e8f0">
            <td style="padding:8px 12px 8px 0;font-family:monospace;color:#0b63ce">recordids</td>
            <td style="padding:8px 0">Comma-separated list of record IDs</td>
          </tr>
        </table>

        <div style="margin-top:16px">
          <strong>Example:</strong>
          <div style="background:#fff;border-radius:4px;padding:12px;margin-top:8px;font-family:monospace;font-size:13px">
            curl 'http://localhost:8000/?recordids=clankr_catalog_agent'
          </div>
        </div>
      </div>
    </div>

    <div style="margin-bottom:32px">
      <h3 style="margin:0 0 12px;color:#334155;font-size:18px">GET /?q={query}</h3>
      <p style="color:#64748b;margin:0 0 16px">Full-text search across all catalog records</p>

      <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;padding:16px">
        <strong>Parameters:</strong>
        <table style="width:100%;margin-top:12px;font-size:14px">
          <tr style="border-bottom:1px solid #e2e8f0">
            <td style="padding:8px 12px 8px 0;font-family:monospace;color:#0b63ce">q</td>
            <td style="padding:8px 0">Search query (keywords, natural language)</td>
          </tr>
          <tr style="border-bottom:1px solid #e2e8f0">
            <td style="padding:8px 12px 12px 0;font-family:monospace;color:#0b63ce">maxrecords</td>
            <td style="padding:8px 0">Maximum results to return (default: 100)</td>
          </tr>
        </table>

        <div style="margin-top:16px">
          <strong>Examples:</strong>
          <div style="background:#fff;border-radius:4px;padding:12px;margin-top:8px;font-family:monospace;font-size:13px">
            # Search for database tables<br>
            curl 'http://localhost:8000/?q=database'<br><br>

            # Find AWS infrastructure<br>
            curl 'http://localhost:8000/?q=Lambda+deployment'<br><br>

            # Search with limit<br>
            curl 'http://localhost:8000/?q=agent&maxrecords=10'
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Response Format -->
  <section class="card">
    <h2 style="margin:0 0 16px">üì¶ Response Format</h2>
    <p class="muted" style="margin:0 0 16px">All responses are in GeoJSON format (STAC-compatible)</p>

    <div style="background:#1e293b;color:#e2e8f0;border-radius:6px;padding:16px;font-family:monospace;font-size:12px;overflow-x:auto">
<pre style="margin:0">{
  "ElapsedTime": 0,
  "Matches": 6,
  "Returned": 6,
  "NextRecord": 6,
  "Records": [{
    "id": "clankr_catalog_agent",
    "type": "Feature",
    "properties": {
      "title": "Catalog Management Agent",
      "abstract": "Your guide to GRO's complete data universe...",
      "collection": "ai_agent",
      "gro_metadata": {
        "continent": "clankr",
        "implementation_status": "active",
        "data_format": "lambda_service",
        "owner": "@clankr"
      },
      "execution": {
        "model": "claude-sonnet-4-5",
        "runtime": "Claude Code CLI"
      }
    }
  }]
}</pre>
    </div>
  </section>

{{end}}

<style>
.btn {
  display:inline-block;
  padding:10px 20px;
  border-radius:6px;
  text-decoration:none;
  font-weight:500;
  transition:all 0.2s;
}
.btn-primary {
  background:#0b63ce;
  color:white;
}
.btn-primary:hover {
  background:#0952a5;
  transform:translateY(-2px);
}
.btn-secondary {
  background:#f3f4f6;
  color:#374151;
  border:1px solid #d1d5db;
}
.btn-secondary:hover {
  background:#e5e7eb;
  transform:translateY(-2px);
}
.query-type-btn.active {
  background:#e0e7ff !important;
  border:2px solid #818cf8 !important;
  color:#3730a3 !important;
  font-weight:700;
}
.filter-input::placeholder {
  color:#9ca3af;
}
.result-card {
  background:#f8fafc;
  border:1px solid #e2e8f0;
  border-radius:8px;
  padding:16px;
  margin-bottom:12px;
  transition:all 0.2s;
}
.result-card:hover {
  border-color:#0b63ce;
  box-shadow:0 4px 6px rgba(0,0,0,0.1);
}
</style>

<script>
// Query Builder Logic
const API_BASE = 'http://localhost:8000';

// DOM Elements
const propertyBuilder = document.getElementById('property-builder');
const textBuilder = document.getElementById('text-builder');
const recordidBuilder = document.getElementById('recordid-builder');
const generatedUrl = document.getElementById('generated-url');
const resultsSection = document.getElementById('results-section');
const resultsContainer = document.getElementById('results-container');
const resultStats = document.getElementById('result-stats');
const advancedFilters = document.getElementById('advanced-filters');
const toggleAdvancedBtn = document.getElementById('toggle-advanced');

// Query type switching
document.querySelectorAll('.query-type-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.query-type-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const type = btn.dataset.type;
    propertyBuilder.style.display = type === 'property' ? 'block' : 'none';
    textBuilder.style.display = type === 'text' ? 'block' : 'none';
    recordidBuilder.style.display = type === 'recordid' ? 'block' : 'none';

    updateGeneratedUrl();
  });
});

// Toggle advanced filters
toggleAdvancedBtn.addEventListener('click', () => {
  const isVisible = advancedFilters.style.display === 'block';
  advancedFilters.style.display = isVisible ? 'none' : 'block';
  toggleAdvancedBtn.textContent = isVisible ? '+ Show Advanced Filters' : '- Hide Advanced Filters';
});

// Update URL as filters change AND auto-run query
document.querySelectorAll('.filter-input, #text-query, #recordid-query, #max-records').forEach(input => {
  input.addEventListener('input', () => {
    updateGeneratedUrl();
    autoRunQuery();
  });
  input.addEventListener('change', () => {
    updateGeneratedUrl();
    autoRunQuery();
  });
});

function updateGeneratedUrl() {
  const activeType = document.querySelector('.query-type-btn.active').dataset.type;
  const params = new URLSearchParams();

  if (activeType === 'property') {
    // Add property filters
    const filters = {
      continent: document.getElementById('filter-continent').value,
      country: document.getElementById('filter-country').value,
      collection: document.getElementById('filter-collection').value,
      status: document.getElementById('filter-status').value,
      data_format: document.getElementById('filter-data-format').value,
      owner: document.getElementById('filter-owner').value,
      database_table: document.getElementById('filter-database-table').value,
      v6_job_type: document.getElementById('filter-v6-job-type').value,
      city: document.getElementById('filter-city').value,
      geographic_scope: document.getElementById('filter-geographic-scope').value
    };

    Object.entries(filters).forEach(([key, value]) => {
      if (value) params.append(key, value);
    });
  } else if (activeType === 'text') {
    const query = document.getElementById('text-query').value;
    if (query) params.append('q', query);
  } else if (activeType === 'recordid') {
    const recordids = document.getElementById('recordid-query').value;
    if (recordids) params.append('recordids', recordids);
  }

  const maxRecords = document.getElementById('max-records').value;
  if (maxRecords && maxRecords !== '10') params.append('maxrecords', maxRecords);

  const url = params.toString() ? `${API_BASE}/?${params.toString()}` : API_BASE;
  generatedUrl.value = url;
}

// Auto-run query when filters change (debounced)
let autoQueryTimeout;
function autoRunQuery() {
  clearTimeout(autoQueryTimeout);
  autoQueryTimeout = setTimeout(() => {
    const url = generatedUrl.value;
    if (url && url !== API_BASE) {
      runQueryRequest(url);
    }
  }, 500); // 500ms debounce
}

// Copy URL to clipboard
document.getElementById('copy-url-btn').addEventListener('click', () => {
  generatedUrl.select();
  document.execCommand('copy');

  const btn = document.getElementById('copy-url-btn');
  const originalText = btn.textContent;
  btn.textContent = '‚úì Copied!';
  setTimeout(() => btn.textContent = originalText, 2000);
});

// Clear all filters
document.getElementById('clear-filters-btn').addEventListener('click', () => {
  document.querySelectorAll('.filter-input').forEach(input => {
    if (input.tagName === 'SELECT') {
      input.selectedIndex = 0;
    } else {
      input.value = '';
    }
  });
  document.getElementById('text-query').value = '';
  document.getElementById('recordid-query').value = '';
  document.getElementById('max-records').value = '10';
  updateGeneratedUrl();
  resultsSection.style.display = 'none';
});

// Load example query
document.getElementById('example-btn').addEventListener('click', () => {
  // Set to property filter mode
  document.querySelector('[data-type="property"]').click();

  // Set example filters
  document.getElementById('filter-continent').value = 'clankr';
  document.getElementById('filter-collection').value = 'ai_agent';
  document.getElementById('filter-status').value = 'active';
  document.getElementById('max-records').value = '10';

  updateGeneratedUrl();
});

// Run query function (reusable)
async function runQueryRequest(url) {
  if (!url || url === API_BASE) {
    return;
  }

  // Show loading state
  resultsSection.style.display = 'block';
  resultsContainer.innerHTML = '<div style="text-align:center;padding:40px;color:#64748b">‚è≥ Loading results...</div>';
  resultStats.textContent = '';

  try {
    const response = await fetch(url);
    const data = await response.json();

    // Update stats
    resultStats.textContent = `Found ${data.Matches} matches, showing ${data.Returned}`;

    // Render results
    if (data.Records && data.Records.length > 0) {
      resultsContainer.innerHTML = data.Records.map(record => {
        const props = record.properties;
        const gro = props.gro_metadata || {};

        return `
          <div class="result-card">
            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px">
              <div>
                <h3 style="margin:0 0 4px;color:#0f172a;font-size:16px">${props.title || record.id}</h3>
                <div style="font-size:13px;color:#64748b;font-family:monospace">${record.id}</div>
              </div>
              <div style="display:flex;gap:6px;flex-wrap:wrap">
                ${props.collection ? `<span style="background:#dbeafe;color:#1e40af;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600">${props.collection}</span>` : ''}
                ${gro.implementation_status ? `<span style="background:#dcfce7;color:#15803d;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600">${gro.implementation_status}</span>` : ''}
              </div>
            </div>

            ${props.abstract ? `<p style="margin:0 0 12px;color:#475569;font-size:14px;line-height:1.5">${props.abstract.substring(0, 200)}${props.abstract.length > 200 ? '...' : ''}</p>` : ''}

            <div style="display:flex;gap:12px;flex-wrap:wrap;font-size:12px;color:#64748b">
              ${gro.continent ? `<span>üåç ${gro.continent}</span>` : ''}
              ${gro.country ? `<span>üè≥Ô∏è ${gro.country}</span>` : ''}
              ${gro.data_format ? `<span>üì¶ ${gro.data_format}</span>` : ''}
              ${gro.owner ? `<span>üë§ ${gro.owner}</span>` : ''}
            </div>

            <div style="margin-top:12px">
              <a href="${API_BASE}/?recordids=${record.id}" target="_blank" style="color:#0b63ce;text-decoration:none;font-size:13px;font-weight:500">
                View Full Record ‚Üí
              </a>
            </div>
          </div>
        `;
      }).join('');
    } else {
      resultsContainer.innerHTML = '<div style="text-align:center;padding:40px;color:#64748b">No results found. Try adjusting your filters.</div>';
    }

  } catch (error) {
    resultsContainer.innerHTML = `<div style="background:#fee;border:1px solid #fcc;border-radius:6px;padding:16px;color:#c00">
      <strong>Error:</strong> ${error.message}
    </div>`;
  }
}

// Run query button
document.getElementById('run-query-btn').addEventListener('click', () => {
  const url = generatedUrl.value;
  if (!url || url === API_BASE) {
    alert('Please configure at least one filter, search term, or record ID');
    return;
  }
  runQueryRequest(url);
});

// Initialize
updateGeneratedUrl();
</script>
