{{define "layout_catalog"}}{{template "layout" .}}{{end}}

{{define "page_title"}}Catalog â€¢ GRO{{end}}

{{define "page_content"}}
<div style="max-width:1400px;margin:0 auto;padding:20px">
  <!-- Header -->
  <div style="text-align:center;margin-bottom:32px">
    <h1 style="font-size:42px;font-weight:700;color:#0f172a;margin:0 0 12px 0">
      ğŸŒ GRO Catalog
    </h1>
    <p style="font-size:18px;color:#64748b;margin:0 0 16px 0">
      Complete system inventory - 1,803 resources across 21 collections
    </p>

    <!-- Quick Links for Agents -->
    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:16px">
      <a href="/stats" style="text-decoration:none;background:#f8fafc;border:1px solid #e2e8f0;padding:8px 16px;border-radius:6px;font-size:13px;color:#475569;font-weight:500">
        ğŸ“Š Statistics
      </a>
      <a href="/api" style="text-decoration:none;background:#f8fafc;border:1px solid #e2e8f0;padding:8px 16px;border-radius:6px;font-size:13px;color:#475569;font-weight:500">
        ğŸ”Œ API Docs
      </a>
      <a href="http://localhost:8000/?collection=ai_agent" target="_blank" style="text-decoration:none;background:#f8fafc;border:1px solid #e2e8f0;padding:8px 16px;border-radius:6px;font-size:13px;color:#475569;font-weight:500">
        ğŸ¤– API Query
      </a>
    </div>

    <div style="font-size:13px;color:#94a3b8">
      7 AI agents â€¢ 47 database tables â€¢ 474 local files â€¢ 627 v6 jobs â€¢ 541 external sources
    </div>
  </div>

  <!-- Search Bar -->
  <section style="margin-bottom:40px">
    <input id="search" type="search"
           placeholder="ğŸ” Search by name, collection, location, or type..."
           aria-label="Search catalog"
           style="width:100%;max-width:700px;margin:0 auto;display:block;padding:18px 24px;font-size:16px;border:2px solid #e5e7eb;border-radius:12px;transition:all 0.2s"
           onfocus="this.style.borderColor='#3b82f6';this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'"
           onblur="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'">
  </section>

  <!-- Browse by Collection (New!) -->
  <section style="margin-bottom:48px">
    <h2 style="font-size:24px;font-weight:600;color:#0f172a;margin:0 0 20px 0;text-align:center">
      Browse by Collection
    </h2>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px">
      <a href="http://localhost:8000/?collection=ai_agent" target="_blank" style="text-decoration:none">
        <div style="background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px;transition:all 0.2s"
             onmouseover="this.style.borderColor='#64748b';this.style.transform='translateY(-2px)'"
             onmouseout="this.style.borderColor='#e2e8f0';this.style.transform='translateY(0)'">
          <div style="font-size:24px;margin-bottom:8px">ğŸ¤–</div>
          <div style="font-size:16px;font-weight:600;color:#0f172a;margin-bottom:4px">AI Agents</div>
          <div style="font-size:13px;color:#64748b">7 agents</div>
        </div>
      </a>

      <a href="http://localhost:8000/?collection=existing_db" target="_blank" style="text-decoration:none">
        <div style="background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px;transition:all 0.2s"
             onmouseover="this.style.borderColor='#64748b';this.style.transform='translateY(-2px)'"
             onmouseout="this.style.borderColor='#e2e8f0';this.style.transform='translateY(0)'">
          <div style="font-size:24px;margin-bottom:8px">ğŸ—„ï¸</div>
          <div style="font-size:16px;font-weight:600;color:#0f172a;margin-bottom:4px">Database Tables</div>
          <div style="font-size:13px;color:#64748b">47 tables</div>
        </div>
      </a>

      <a href="http://localhost:8000/?collection=existing_local" target="_blank" style="text-decoration:none">
        <div style="background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px;transition:all 0.2s"
             onmouseover="this.style.borderColor='#64748b';this.style.transform='translateY(-2px)'"
             onmouseout="this.style.borderColor='#e2e8f0';this.style.transform='translateY(0)'">
          <div style="font-size:24px;margin-bottom:8px">ğŸ“</div>
          <div style="font-size:16px;font-weight:600;color:#0f172a;margin-bottom:4px">Local Files</div>
          <div style="font-size:13px;color:#64748b">474 files</div>
        </div>
      </a>

      <a href="http://localhost:8000/?collection=potential_v6" target="_blank" style="text-decoration:none">
        <div style="background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px;transition:all 0.2s"
             onmouseover="this.style.borderColor='#64748b';this.style.transform='translateY(-2px)'"
             onmouseout="this.style.borderColor='#e2e8f0';this.style.transform='translateY(0)'">
          <div style="font-size:24px;margin-bottom:8px">âš™ï¸</div>
          <div style="font-size:16px;font-weight:600;color:#0f172a;margin-bottom:4px">v6 Jobs</div>
          <div style="font-size:13px;color:#64748b">627 jobs</div>
        </div>
      </a>

      <a href="http://localhost:8000/?collection=external_api" target="_blank" style="text-decoration:none">
        <div style="background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px;transition:all 0.2s"
             onmouseover="this.style.borderColor='#64748b';this.style.transform='translateY(-2px)'"
             onmouseout="this.style.borderColor='#e2e8f0';this.style.transform='translateY(0)'">
          <div style="font-size:24px;margin-bottom:8px">ğŸ”Œ</div>
          <div style="font-size:16px;font-weight:600;color:#0f172a;margin-bottom:4px">External APIs</div>
          <div style="font-size:13px;color:#64748b">View collection</div>
        </div>
      </a>

      <a href="http://localhost:8000/?collection=external_government" target="_blank" style="text-decoration:none">
        <div style="background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:16px;transition:all 0.2s"
             onmouseover="this.style.borderColor='#64748b';this.style.transform='translateY(-2px)'"
             onmouseout="this.style.borderColor='#e2e8f0';this.style.transform='translateY(0)'">
          <div style="font-size:24px;margin-bottom:8px">ğŸ›ï¸</div>
          <div style="font-size:16px;font-weight:600;color:#0f172a;margin-bottom:4px">Government Data</div>
          <div style="font-size:13px;color:#64748b">View collection</div>
        </div>
      </a>
    </div>

    <div style="text-align:center;margin-top:16px">
      <a href="/stats" style="font-size:13px;color:#475569;text-decoration:none;font-weight:500">
        View all 21 collections â†’
      </a>
    </div>
  </section>

  <!-- Geographic Continents -->
  <section style="margin-bottom:32px">
    <h2 style="font-size:24px;font-weight:600;color:#0f172a;margin:0 0 20px 0;text-align:center">
      Browse by Geographic Region
    </h2>

    <!-- Actual Continents Only -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px">
      {{range .Stats.Continents}}
      {{if or (eq .Code "africa") (eq .Code "asia") (eq .Code "europe") (eq .Code "north-america") (eq .Code "south-america") (eq .Code "oceania")}}
      <a href="/geography/?continent={{.Code}}" style="text-decoration:none">
        <div style="background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:20px;transition:all 0.2s;cursor:pointer"
             onmouseover="this.style.borderColor='#64748b';this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'"
             onmouseout="this.style.borderColor='#e2e8f0';this.style.boxShadow='none'">

          <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
            <span style="font-size:32px">{{.Emoji}}</span>
            <h3 style="font-size:18px;font-weight:600;color:#0f172a;margin:0">{{.Name}}</h3>
          </div>

          <div style="display:flex;align-items:baseline;gap:6px">
            <span style="font-size:24px;font-weight:700;color:#475569">{{.Count}}</span>
            <span style="font-size:13px;color:#64748b">resources</span>
          </div>
        </div>
      </a>
      {{end}}
      {{end}}
    </div>
  </section>

  <!-- Organizational Regions -->
  <section style="margin-bottom:32px">
    <h2 style="font-size:20px;font-weight:600;color:#0f172a;margin:0 0 16px 0;text-align:center">
      System & Organizational
    </h2>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;max-width:900px;margin:0 auto">
      {{range .Stats.Continents}}
      {{if or (eq .Code "clankr") (eq .Code "global") (eq .Code "infra") (eq .Code "team") (eq .Code "verbs")}}
      <a href="/geography/?continent={{.Code}}" style="text-decoration:none">
        <div style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;padding:14px;transition:all 0.2s"
             onmouseover="this.style.borderColor='#64748b'"
             onmouseout="this.style.borderColor='#e2e8f0'">
          <div style="font-size:20px;margin-bottom:6px">{{.Emoji}}</div>
          <div style="font-size:14px;font-weight:600;color:#0f172a;margin-bottom:2px">{{.Name}}</div>
          <div style="font-size:12px;color:#64748b">{{.Count}} resources</div>
        </div>
      </a>
      {{end}}
      {{end}}
    </div>
  </section>

  <!-- Top Countries -->
  <section style="margin-top:48px" id="topCountries">
    <h2 style="font-size:24px;font-weight:600;color:#0f172a;margin:0 0 24px 0;text-align:center">
      Popular Countries
    </h2>

    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px">
      {{range $index, $country := .Stats.Countries}}
        {{if lt $index 12}}
        <a href="/geography/?country={{$country.Code}}" style="text-decoration:none">
          <div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:16px;transition:all 0.2s"
               onmouseover="this.style.borderColor='#3b82f6';this.style.transform='translateY(-2px)'"
               onmouseout="this.style.borderColor='#e5e7eb';this.style.transform='translateY(0)'">

            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <span style="font-size:24px">{{$country.Flag}}</span>
              <span style="font-size:15px;font-weight:600;color:#0f172a">{{$country.Name}}</span>
            </div>

            <div style="font-size:12px;color:#64748b">
              <span style="font-weight:600;color:#3b82f6">{{$country.Count}}</span> datasets
            </div>
          </div>
        </a>
        {{end}}
      {{end}}
    </div>
  </section>


  <!-- Search Results (hidden by default, shown when searching) -->
  <div id="searchResults" style="display:none;margin-top:48px">
    <div style="margin-bottom:16px;font-size:14px;color:#64748b;text-align:center">
      Found <span id="resultCount" style="font-weight:600;color:#3b82f6">0</span> datasets
    </div>

    <div id="resultsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px">
      {{range .Records}}
      <div class="searchResult" data-name="{{.Properties.Title}}" data-collection="{{.Properties.Collection}}"
           data-continent="{{.Properties.GROMetadata.Continent}}" data-country="{{.Properties.GROMetadata.Country}}"
           style="display:none;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:16px">

        <!-- Geography badges -->
        {{if .Properties.GROMetadata.Country}}
        <div style="margin-bottom:10px">
          <span style="display:inline-block;padding:4px 10px;background:#e0f2fe;color:#0369a1;border-radius:4px;font-size:11px;font-weight:500">
            {{countryFlag .Properties.GROMetadata.Country}} {{countryName .Properties.GROMetadata.Country}}
          </span>
        </div>
        {{end}}

        <!-- Title -->
        <a href="/dataset/{{.ID}}" style="font-size:15px;font-weight:600;color:#0f172a;text-decoration:none;display:block;margin-bottom:8px;line-height:1.4">
          {{.Properties.Title}}
        </a>

        <!-- Collection badge -->
        <div style="margin-bottom:8px">
          {{if eq .Properties.Collection "potential_v6"}}
            <span style="font-size:10px;padding:3px 8px;background:#dbeafe;color:#1e40af;border-radius:3px;font-weight:500">âš™ï¸ v6 job</span>
          {{else if eq .Properties.Collection "existing_db"}}
            <span style="font-size:10px;padding:3px 8px;background:#d1fae5;color:#065f46;border-radius:3px;font-weight:500">ğŸ—„ï¸ database</span>
          {{else if eq .Properties.Collection "existing_local"}}
            <span style="font-size:10px;padding:3px 8px;background:#fef3c7;color:#92400e;border-radius:3px;font-weight:500">ğŸ“ file</span>
          {{else if eq .Properties.Collection "external_api"}}
            <span style="font-size:10px;padding:3px 8px;background:#f3e8ff;color:#6b21a8;border-radius:3px;font-weight:500">ğŸ”Œ API</span>
          {{end}}
        </div>

        <!-- Abstract -->
        {{if .Properties.Abstract}}
        <p style="font-size:12px;color:#6b7280;margin:0;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">
          {{.Properties.Abstract}}
        </p>
        {{end}}
      </div>
      {{end}}
    </div>
  </div>
</div>
{{end}}

{{define "scripts_extra"}}
<script>
// Simple search functionality
const searchInput = document.getElementById('search');
const searchResults = document.getElementById('searchResults');
const resultsGrid = document.getElementById('resultsGrid');
const resultCount = document.getElementById('resultCount');
const allResults = document.querySelectorAll('.searchResult');
const topCountries = document.getElementById('topCountries');

searchInput.addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase().trim();

  if (!query) {
    // Hide search results, show geography navigation
    searchResults.style.display = 'none';
    topCountries.style.display = 'block';
    allResults.forEach(r => r.style.display = 'none');
    return;
  }

  // Show search results, hide geography navigation
  searchResults.style.display = 'block';
  topCountries.style.display = 'none';

  let count = 0;
  allResults.forEach(result => {
    const name = result.dataset.name.toLowerCase();
    const collection = result.dataset.collection.toLowerCase();
    const continent = result.dataset.continent.toLowerCase();
    const country = result.dataset.country.toLowerCase();

    if (name.includes(query) || collection.includes(query) || continent.includes(query) || country.includes(query)) {
      result.style.display = 'block';
      count++;
    } else {
      result.style.display = 'none';
    }
  });

  resultCount.textContent = count;
});
</script>
{{end}}
