{{define "layout_catalog"}}{{template "layout" .}}{{end}}

{{define "page_title"}}Catalog • GRO{{end}}

{{define "page_content"}}
<div style="max-width:1400px;margin:0 auto;padding:20px">
  <!-- Header -->
  <div style="text-align:center;margin-bottom:48px">
    <h1 style="font-size:42px;font-weight:700;color:#0f172a;margin:0 0 12px 0">
      🌍 GRO Data Catalog
    </h1>
    <p style="font-size:18px;color:#64748b;margin:0 0 12px 0">
      Explore datasets by geography
    </p>
    <div style="font-size:14px;color:#94a3b8">
      <span style="font-weight:600;color:#3b82f6">{{.Stats.Total}}</span> datasets •
      <span>{{.Stats.PotentialV6}} ⚙️ jobs</span> •
      <span>{{.Stats.DataRecords}} 📊 data sources</span>
    </div>
  </div>

  <!-- Search Bar -->
  <section style="margin-bottom:48px">
    <input id="search" type="search"
           placeholder="🔍 Search datasets by name, location, or type..."
           aria-label="Search catalog"
           style="width:100%;max-width:700px;margin:0 auto;display:block;padding:18px 24px;font-size:16px;border:2px solid #e5e7eb;border-radius:12px;transition:all 0.2s"
           onfocus="this.style.borderColor='#3b82f6';this.style.boxShadow='0 0 0 3px rgba(59,130,246,0.1)'"
           onblur="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'">
  </section>

  <!-- Geographic Navigation -->
  <section style="margin-bottom:32px">
    <h2 style="font-size:24px;font-weight:600;color:#0f172a;margin:0 0 24px 0;text-align:center">
      Browse by Region
    </h2>

    <!-- Continents Grid -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px">
      {{range .Stats.Continents}}
      <a href="/geography/?continent={{.Code}}" style="text-decoration:none">
        <div style="background:#fff;border:2px solid #e5e7eb;border-radius:12px;padding:24px;transition:all 0.2s;cursor:pointer"
             onmouseover="this.style.borderColor='#3b82f6';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'"
             onmouseout="this.style.borderColor='#e5e7eb';this.style.boxShadow='none'">

          <!-- Continent Emoji & Name -->
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
            <div style="display:flex;align-items:center;gap:12px">
              <span style="font-size:36px">{{.Emoji}}</span>
              <h3 style="font-size:20px;font-weight:600;color:#0f172a;margin:0">{{.Name}}</h3>
            </div>
            <span style="font-size:14px;color:#94a3b8">→</span>
          </div>

          <!-- Count -->
          <div style="display:flex;align-items:baseline;gap:8px">
            <span style="font-size:32px;font-weight:700;color:#3b82f6">{{.Count}}</span>
            <span style="font-size:14px;color:#64748b">{{if eq .Count 1}}dataset{{else}}datasets{{end}}</span>
          </div>

        </div>
      </a>
      {{end}}
    </div>
  </section>

  <!-- Top Countries -->
  <section style="margin-top:48px" id="topCountries">
    <h2 style="font-size:24px;font-weight:600;color:#0f172a;margin:0 0 24px 0;text-align:center">
      Popular Countries
    </h2>

    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px">
      {{range $index, $country := .Stats.Countries}}
        {{if lt $index 12}}
        <a href="/geography/?country={{$country.Code}}" style="text-decoration:none">
          <div style="background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:16px;transition:all 0.2s"
               onmouseover="this.style.borderColor='#3b82f6';this.style.transform='translateY(-2px)'"
               onmouseout="this.style.borderColor='#e5e7eb';this.style.transform='translateY(0)'">

            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <span style="font-size:24px">{{$country.Flag}}</span>
              <span style="font-size:15px;font-weight:600;color:#0f172a">{{$country.Name}}</span>
            </div>

            <div style="font-size:12px;color:#64748b">
              <span style="font-weight:600;color:#3b82f6">{{$country.Count}}</span> datasets
            </div>
          </div>
        </a>
        {{end}}
      {{end}}
    </div>
  </section>

  <!-- Quick Stats -->
  <section style="margin-top:64px;padding:32px;background:#f8fafc;border-radius:12px;border:1px solid #e5e7eb">
    <h2 style="font-size:20px;font-weight:600;color:#0f172a;margin:0 0 20px 0;text-align:center">
      Dataset Types
    </h2>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px">
      <div style="text-align:center;padding:16px">
        <div style="font-size:28px;font-weight:700;color:#3b82f6;margin-bottom:4px">{{.Stats.PotentialV6}}</div>
        <div style="font-size:13px;color:#64748b">⚙️ v6 Jobs</div>
      </div>

      <div style="text-align:center;padding:16px">
        <div style="font-size:28px;font-weight:700;color:#059669;margin-bottom:4px">{{.Stats.ExistingDB}}</div>
        <div style="font-size:13px;color:#64748b">🗄️ Database Tables</div>
      </div>

      <div style="text-align:center;padding:16px">
        <div style="font-size:28px;font-weight:700;color:#d97706;margin-bottom:4px">{{.Stats.ExistingLocal}}</div>
        <div style="font-size:13px;color:#64748b">📁 Local Files</div>
      </div>

      <div style="text-align:center;padding:16px">
        <div style="font-size:28px;font-weight:700;color:#7c3aed;margin-bottom:4px">{{.Stats.ExternalAPI}}</div>
        <div style="font-size:13px;color:#64748b">🔌 External APIs</div>
      </div>

      <div style="text-align:center;padding:16px">
        <div style="font-size:28px;font-weight:700;color:#dc2626;margin-bottom:4px">{{.Stats.ExternalNews}}</div>
        <div style="font-size:13px;color:#64748b">📰 News Sources</div>
      </div>

      <div style="text-align:center;padding:16px">
        <div style="font-size:28px;font-weight:700;color:#2563eb;margin-bottom:4px">{{.Stats.ExternalGov}}</div>
        <div style="font-size:13px;color:#64748b">🏛️ Government</div>
      </div>
    </div>
  </section>

  <!-- Search Results (hidden by default, shown when searching) -->
  <div id="searchResults" style="display:none;margin-top:48px">
    <div style="margin-bottom:16px;font-size:14px;color:#64748b;text-align:center">
      Found <span id="resultCount" style="font-weight:600;color:#3b82f6">0</span> datasets
    </div>

    <div id="resultsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px">
      {{range .Records}}
      <div class="searchResult" data-name="{{.Properties.Title}}" data-collection="{{.Properties.Collection}}"
           data-continent="{{.Properties.GROMetadata.Continent}}" data-country="{{.Properties.GROMetadata.Country}}"
           style="display:none;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:16px">

        <!-- Geography badges -->
        {{if .Properties.GROMetadata.Country}}
        <div style="margin-bottom:10px">
          <span style="display:inline-block;padding:4px 10px;background:#e0f2fe;color:#0369a1;border-radius:4px;font-size:11px;font-weight:500">
            {{countryFlag .Properties.GROMetadata.Country}} {{countryName .Properties.GROMetadata.Country}}
          </span>
        </div>
        {{end}}

        <!-- Title -->
        <a href="/dataset/{{.ID}}" style="font-size:15px;font-weight:600;color:#0f172a;text-decoration:none;display:block;margin-bottom:8px;line-height:1.4">
          {{.Properties.Title}}
        </a>

        <!-- Collection badge -->
        <div style="margin-bottom:8px">
          {{if eq .Properties.Collection "potential_v6"}}
            <span style="font-size:10px;padding:3px 8px;background:#dbeafe;color:#1e40af;border-radius:3px;font-weight:500">⚙️ v6 job</span>
          {{else if eq .Properties.Collection "existing_db"}}
            <span style="font-size:10px;padding:3px 8px;background:#d1fae5;color:#065f46;border-radius:3px;font-weight:500">🗄️ database</span>
          {{else if eq .Properties.Collection "existing_local"}}
            <span style="font-size:10px;padding:3px 8px;background:#fef3c7;color:#92400e;border-radius:3px;font-weight:500">📁 file</span>
          {{else if eq .Properties.Collection "external_api"}}
            <span style="font-size:10px;padding:3px 8px;background:#f3e8ff;color:#6b21a8;border-radius:3px;font-weight:500">🔌 API</span>
          {{end}}
        </div>

        <!-- Abstract -->
        {{if .Properties.Abstract}}
        <p style="font-size:12px;color:#6b7280;margin:0;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">
          {{.Properties.Abstract}}
        </p>
        {{end}}
      </div>
      {{end}}
    </div>
  </div>
</div>
{{end}}

{{define "scripts_extra"}}
<script>
// Simple search functionality
const searchInput = document.getElementById('search');
const searchResults = document.getElementById('searchResults');
const resultsGrid = document.getElementById('resultsGrid');
const resultCount = document.getElementById('resultCount');
const allResults = document.querySelectorAll('.searchResult');
const topCountries = document.getElementById('topCountries');

searchInput.addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase().trim();

  if (!query) {
    // Hide search results, show geography navigation
    searchResults.style.display = 'none';
    topCountries.style.display = 'block';
    allResults.forEach(r => r.style.display = 'none');
    return;
  }

  // Show search results, hide geography navigation
  searchResults.style.display = 'block';
  topCountries.style.display = 'none';

  let count = 0;
  allResults.forEach(result => {
    const name = result.dataset.name.toLowerCase();
    const collection = result.dataset.collection.toLowerCase();
    const continent = result.dataset.continent.toLowerCase();
    const country = result.dataset.country.toLowerCase();

    if (name.includes(query) || collection.includes(query) || continent.includes(query) || country.includes(query)) {
      result.style.display = 'block';
      count++;
    } else {
      result.style.display = 'none';
    }
  });

  resultCount.textContent = count;
});
</script>
{{end}}
